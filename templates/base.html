<!doctype html>
<html lang="en">
    <head>
        {% include "_head.html" %}
        {% block extra_head %}
        {% endblock %}
    </head>
    <body>
        <header>
            <nav class="navbar">
                <div class="nav-container">
                    <div class="nav-logo">
                        <a href="{{ url_for('index') }}"> <i class="fas fa-calendar-alt"></i> Campus Scheduler </a>
                    </div>

                    <button class="nav-toggle" aria-label="toggle navigation">
                        <i class="fas fa-bars"></i>
                    </button>

                    {% import "macros/navigation.html" as nav %}
                    <ul class="nav-menu">
                        {{ nav.link('Home',    'index',   'fas fa-home') }}

                        {% if not session.get('username') %}
                            {{ nav.link('About',   'about',   'fas fa-info-circle') }}
                            {{ nav.link('Privacy', 'privacy', 'fas fa-user-shield') }}
                            {{ nav.link('Login',    'auth.login',    'fas fa-sign-in-alt') }}
                            {{ nav.link('Register', 'auth.register', 'fas fa-user-plus') }}
                        {% else %}
                            {% set role = session.get('role_name','') %}
                            {% set is_admin = role in ['Admin','Manager'] %}

                            {% if is_admin %}
                                {{ nav.link('Projects', 'projects', 'fas fa-project-diagram') }}
                            {% endif %}
                            {{ nav.link('Tasks',  'tasks',  'fas fa-tasks') }}
                            {{ nav.link('Events', 'events', 'fas fa-calendar') }}
                            {% if is_admin %}
                                {{ nav.link('Costs', 'analysis', 'fas fa-dollar-sign') }}
                            {% endif %}
                            <li class="nav-item profile-dropdown" id="profile-dropdown">
                                <a href="#" class="nav-link profile-trigger">
                                    <img
                                        src="{{ session.get('profile_pic', url_for('static', filename='images/placeholder.jpg')) }}"
                                        alt="Profile Picture"
                                        class="profile-pic"
                                    />
                                    <span class="profile-name"
                                        >{{ session.get('name', session.get('username', 'User')) }}</span
                                    >
                                    <i class="fas fa-caret-down" id="caret-down"></i>
                                </a>
                                <div class="dropdown-content">
                                    <div class="profile-info">
                                        <img
                                            src="{{ session.get('profile_pic', url_for('static', filename='images/placeholder.jpg')) }}"
                                            alt="Profile Picture"
                                            class="profile-pic-large"
                                        />
                                        <div class="profile-text">
                                            <span class="profile-username"
                                                >{{ session.get('username', 'Profile') }}</span
                                            >
                                            <span class="profile-username">{{ session.get('role_name', 'User') }}</span>
                                        </div>
                                    </div>
                                    <hr />
                                    <div>
                                        <div class="theme-switch-wrapper dropdown-link">
                                            <label class="theme-switch-label" for="theme-checkbox">
                                                <span style="margin-right: 8px; vertical-align: middle;"
                                                    >Dark theme</span
                                                >
                                                <div class="theme-switch">
                                                    <input type="checkbox" id="theme-checkbox" />
                                                    <div class="slider round"></div>
                                                </div>
                                            </label>
                                        </div>
                                        <a href="{{ url_for('auth.logout') }}" class="dropdown-link">Logout</a>
                                    </div>
                                </div>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </nav>
        </header>

        <main class="container">{% block content %}{% endblock %}</main>

        <footer class="footer">
            <div class="footer-container">Â© {{ (now().year) }} Campus Scheduler. All rights reserved.</div>
        </footer>

        {% block scripts %}
            <script src="{{ url_for('static', filename='js/navbar.js') }}" defer></script>
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    Sentry.init({
                        dsn: "https://bd6cee1c1e85487299af017f4c6b0117@app.glitchtip.com/11317",
                        tracesSampleRate: 0.01,
                    });
                });
            </script>
        {% endblock %}

        {% block extra_js %}
        {% endblock %}

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <script type="module">
                        Swal.fire({
                            icon: "{{ category }}",
                            title: "{{ message }}",
                            showConfirmButton: true,
                            timer: 3000,
                        });
                    </script>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </body>
</html>
